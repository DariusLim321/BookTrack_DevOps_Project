function cov_1ghbcsw0z7(){var path="C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\Part 3\\BookTrack_DevOps_Project-LimJunLeDarius\\utils\\search-book-util.js";var hash="a34279bf90f66fb33f578bc0b954ad1cb2295c21";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\Part 3\\BookTrack_DevOps_Project-LimJunLeDarius\\utils\\search-book-util.js",statementMap:{"0":{start:{line:2,column:13},end:{line:2,column:41}},"1":{start:{line:3,column:17},end:{line:3,column:36}},"2":{start:{line:6,column:18},end:{line:6,column:48}},"3":{start:{line:9,column:4},end:{line:11,column:5}},"4":{start:{line:10,column:8},end:{line:10,column:121}},"5":{start:{line:14,column:4},end:{line:16,column:5}},"6":{start:{line:15,column:8},end:{line:15,column:99}},"7":{start:{line:19,column:34},end:{line:19,column:50}},"8":{start:{line:20,column:4},end:{line:22,column:5}},"9":{start:{line:21,column:8},end:{line:21,column:138}},"10":{start:{line:24,column:4},end:{line:46,column:5}},"11":{start:{line:26,column:30},end:{line:28,column:10}},"12":{start:{line:31,column:8},end:{line:33,column:9}},"13":{start:{line:32,column:12},end:{line:32,column:93}},"14":{start:{line:36,column:8},end:{line:36,column:44}},"15":{start:{line:39,column:8},end:{line:39,column:91}},"16":{start:{line:42,column:8},end:{line:45,column:11}},"17":{start:{line:52,column:4},end:{line:52,column:58}},"18":{start:{line:55,column:0},end:{line:55,column:33}}},fnMap:{"0":{name:"searchBooks",decl:{start:{line:5,column:15},end:{line:5,column:26}},loc:{start:{line:5,column:37},end:{line:48,column:1}},line:5},"1":{name:"escapeRegex",decl:{start:{line:51,column:9},end:{line:51,column:20}},loc:{start:{line:51,column:27},end:{line:53,column:1}},line:51}},branchMap:{"0":{loc:{start:{line:9,column:4},end:{line:11,column:5}},type:"if",locations:[{start:{line:9,column:4},end:{line:11,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:9},"1":{loc:{start:{line:9,column:8},end:{line:9,column:66}},type:"binary-expr",locations:[{start:{line:9,column:8},end:{line:9,column:14}},{start:{line:9,column:18},end:{line:9,column:43}},{start:{line:9,column:47},end:{line:9,column:66}}],line:9},"2":{loc:{start:{line:14,column:4},end:{line:16,column:5}},type:"if",locations:[{start:{line:14,column:4},end:{line:16,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:14},"3":{loc:{start:{line:20,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:22,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:20},"4":{loc:{start:{line:31,column:8},end:{line:33,column:9}},type:"if",locations:[{start:{line:31,column:8},end:{line:33,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:31}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"a34279bf90f66fb33f578bc0b954ad1cb2295c21"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_1ghbcsw0z7=function(){return actualCoverage;};}return actualCoverage;}cov_1ghbcsw0z7();// Import the Book model to interact with the database
const Book=(cov_1ghbcsw0z7().s[0]++,require('../models/book.js'));const mongoose=(cov_1ghbcsw0z7().s[1]++,require('mongoose'));// Import mongoose to validate object IDs
async function searchBooks(req,res){cov_1ghbcsw0z7().f[0]++;const query=(cov_1ghbcsw0z7().s[2]++,req.query.query?.toLowerCase());// Use optional chaining to safely access query
// Check if the query is provided and valid
cov_1ghbcsw0z7().s[3]++;if((cov_1ghbcsw0z7().b[1][0]++,!query)||(cov_1ghbcsw0z7().b[1][1]++,typeof query!=='string')||(cov_1ghbcsw0z7().b[1][2]++,query.trim()==='')){cov_1ghbcsw0z7().b[0][0]++;cov_1ghbcsw0z7().s[4]++;return res.status(400).json({error:'Invalid parameter: "query" is required and must be a non-empty string.'});}else{cov_1ghbcsw0z7().b[0][1]++;}// Limit query length to 100 characters
cov_1ghbcsw0z7().s[5]++;if(query.length>100){cov_1ghbcsw0z7().b[2][0]++;cov_1ghbcsw0z7().s[6]++;return res.status(400).json({error:'Query is too long. Max length is 100 characters.'});}else{cov_1ghbcsw0z7().b[2][1]++;}// Check for special characters in the query (only allow alphanumeric and space)
const specialCharacterRegex=(cov_1ghbcsw0z7().s[7]++,/[^a-zA-Z0-9\s]/);// Regular expression to check for non-alphanumeric characters
cov_1ghbcsw0z7().s[8]++;if(specialCharacterRegex.test(query)){cov_1ghbcsw0z7().b[3][0]++;cov_1ghbcsw0z7().s[9]++;return res.status(400).json({error:'Query contains special characters. Only alphanumeric characters and spaces are allowed.'});}else{cov_1ghbcsw0z7().b[3][1]++;}cov_1ghbcsw0z7().s[10]++;try{// Search for books that match the title
const filteredBooks=(cov_1ghbcsw0z7().s[11]++,await Book.find({title:{$regex:escapeRegex(query),$options:'i'}// Case-insensitive search with escaped query
}));// Check if any books are found
cov_1ghbcsw0z7().s[12]++;if(filteredBooks.length===0){cov_1ghbcsw0z7().b[4][0]++;cov_1ghbcsw0z7().s[13]++;return res.status(404).json({message:'No books found matching your search.'});}else{cov_1ghbcsw0z7().b[4][1]++;}// Return the filtered results
cov_1ghbcsw0z7().s[14]++;res.status(200).json(filteredBooks);// Send 200 OK status with the results
}catch(error){cov_1ghbcsw0z7().s[15]++;// Log the error for internal debugging
console.error('Error fetching books for query:',query,'\nError details:',error);// Send the correct error message to match the test case expectation
cov_1ghbcsw0z7().s[16]++;res.status(500).json({error:'Internal Server Error'// Change this to match the test expectation
// Optionally include the error message in logs or internal response
});}}// Function to escape regex special characters
function escapeRegex(text){cov_1ghbcsw0z7().f[1]++;cov_1ghbcsw0z7().s[17]++;return text.replace(/[-\/\\^$.*+?()[\]{}|]/g,'\\$&');// Escape special characters
}cov_1ghbcsw0z7().s[18]++;module.exports={searchBooks};// Export the searchBooks function to be used in index.js
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMWdoYmNzdzB6NyIsImFjdHVhbENvdmVyYWdlIiwiQm9vayIsInMiLCJyZXF1aXJlIiwibW9uZ29vc2UiLCJzZWFyY2hCb29rcyIsInJlcSIsInJlcyIsImYiLCJxdWVyeSIsInRvTG93ZXJDYXNlIiwiYiIsInRyaW0iLCJzdGF0dXMiLCJqc29uIiwiZXJyb3IiLCJsZW5ndGgiLCJzcGVjaWFsQ2hhcmFjdGVyUmVnZXgiLCJ0ZXN0IiwiZmlsdGVyZWRCb29rcyIsImZpbmQiLCJ0aXRsZSIsIiRyZWdleCIsImVzY2FwZVJlZ2V4IiwiJG9wdGlvbnMiLCJtZXNzYWdlIiwiY29uc29sZSIsInRleHQiLCJyZXBsYWNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VzIjpbInNlYXJjaC1ib29rLXV0aWwuanMiXSwic291cmNlc0NvbnRlbnQiOlsiLy8gSW1wb3J0IHRoZSBCb29rIG1vZGVsIHRvIGludGVyYWN0IHdpdGggdGhlIGRhdGFiYXNlXHJcbmNvbnN0IEJvb2sgPSByZXF1aXJlKCcuLi9tb2RlbHMvYm9vay5qcycpO1xyXG5jb25zdCBtb25nb29zZSA9IHJlcXVpcmUoJ21vbmdvb3NlJyk7IC8vIEltcG9ydCBtb25nb29zZSB0byB2YWxpZGF0ZSBvYmplY3QgSURzXHJcblxyXG5hc3luYyBmdW5jdGlvbiBzZWFyY2hCb29rcyhyZXEsIHJlcykge1xyXG4gICAgY29uc3QgcXVlcnkgPSByZXEucXVlcnkucXVlcnk/LnRvTG93ZXJDYXNlKCk7IC8vIFVzZSBvcHRpb25hbCBjaGFpbmluZyB0byBzYWZlbHkgYWNjZXNzIHF1ZXJ5XHJcblxyXG4gICAgLy8gQ2hlY2sgaWYgdGhlIHF1ZXJ5IGlzIHByb3ZpZGVkIGFuZCB2YWxpZFxyXG4gICAgaWYgKCFxdWVyeSB8fCB0eXBlb2YgcXVlcnkgIT09ICdzdHJpbmcnIHx8IHF1ZXJ5LnRyaW0oKSA9PT0gJycpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ0ludmFsaWQgcGFyYW1ldGVyOiBcInF1ZXJ5XCIgaXMgcmVxdWlyZWQgYW5kIG11c3QgYmUgYSBub24tZW1wdHkgc3RyaW5nLicgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gTGltaXQgcXVlcnkgbGVuZ3RoIHRvIDEwMCBjaGFyYWN0ZXJzXHJcbiAgICBpZiAocXVlcnkubGVuZ3RoID4gMTAwKSB7XHJcbiAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAwKS5qc29uKHsgZXJyb3I6ICdRdWVyeSBpcyB0b28gbG9uZy4gTWF4IGxlbmd0aCBpcyAxMDAgY2hhcmFjdGVycy4nIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIENoZWNrIGZvciBzcGVjaWFsIGNoYXJhY3RlcnMgaW4gdGhlIHF1ZXJ5IChvbmx5IGFsbG93IGFscGhhbnVtZXJpYyBhbmQgc3BhY2UpXHJcbiAgICBjb25zdCBzcGVjaWFsQ2hhcmFjdGVyUmVnZXggPSAvW15hLXpBLVowLTlcXHNdLzsgLy8gUmVndWxhciBleHByZXNzaW9uIHRvIGNoZWNrIGZvciBub24tYWxwaGFudW1lcmljIGNoYXJhY3RlcnNcclxuICAgIGlmIChzcGVjaWFsQ2hhcmFjdGVyUmVnZXgudGVzdChxdWVyeSkpIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1F1ZXJ5IGNvbnRhaW5zIHNwZWNpYWwgY2hhcmFjdGVycy4gT25seSBhbHBoYW51bWVyaWMgY2hhcmFjdGVycyBhbmQgc3BhY2VzIGFyZSBhbGxvd2VkLicgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgdHJ5IHtcclxuICAgICAgICAvLyBTZWFyY2ggZm9yIGJvb2tzIHRoYXQgbWF0Y2ggdGhlIHRpdGxlXHJcbiAgICAgICAgY29uc3QgZmlsdGVyZWRCb29rcyA9IGF3YWl0IEJvb2suZmluZCh7XHJcbiAgICAgICAgICAgIHRpdGxlOiB7ICRyZWdleDogZXNjYXBlUmVnZXgocXVlcnkpLCAkb3B0aW9uczogJ2knIH0gLy8gQ2FzZS1pbnNlbnNpdGl2ZSBzZWFyY2ggd2l0aCBlc2NhcGVkIHF1ZXJ5XHJcbiAgICAgICAgfSk7XHJcblxyXG4gICAgICAgIC8vIENoZWNrIGlmIGFueSBib29rcyBhcmUgZm91bmRcclxuICAgICAgICBpZiAoZmlsdGVyZWRCb29rcy5sZW5ndGggPT09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHsgbWVzc2FnZTogJ05vIGJvb2tzIGZvdW5kIG1hdGNoaW5nIHlvdXIgc2VhcmNoLicgfSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICAvLyBSZXR1cm4gdGhlIGZpbHRlcmVkIHJlc3VsdHNcclxuICAgICAgICByZXMuc3RhdHVzKDIwMCkuanNvbihmaWx0ZXJlZEJvb2tzKTsgLy8gU2VuZCAyMDAgT0sgc3RhdHVzIHdpdGggdGhlIHJlc3VsdHNcclxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XHJcbiAgICAgICAgLy8gTG9nIHRoZSBlcnJvciBmb3IgaW50ZXJuYWwgZGVidWdnaW5nXHJcbiAgICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZmV0Y2hpbmcgYm9va3MgZm9yIHF1ZXJ5OicsIHF1ZXJ5LCAnXFxuRXJyb3IgZGV0YWlsczonLCBlcnJvcik7XHJcbiAgICBcclxuICAgICAgICAvLyBTZW5kIHRoZSBjb3JyZWN0IGVycm9yIG1lc3NhZ2UgdG8gbWF0Y2ggdGhlIHRlc3QgY2FzZSBleHBlY3RhdGlvblxyXG4gICAgICAgIHJlcy5zdGF0dXMoNTAwKS5qc29uKHtcclxuICAgICAgICAgICAgZXJyb3I6ICdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InIC8vIENoYW5nZSB0aGlzIHRvIG1hdGNoIHRoZSB0ZXN0IGV4cGVjdGF0aW9uXHJcbiAgICAgICAgICAgIC8vIE9wdGlvbmFsbHkgaW5jbHVkZSB0aGUgZXJyb3IgbWVzc2FnZSBpbiBsb2dzIG9yIGludGVybmFsIHJlc3BvbnNlXHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBcclxufVxyXG5cclxuLy8gRnVuY3Rpb24gdG8gZXNjYXBlIHJlZ2V4IHNwZWNpYWwgY2hhcmFjdGVyc1xyXG5mdW5jdGlvbiBlc2NhcGVSZWdleCh0ZXh0KSB7XHJcbiAgICByZXR1cm4gdGV4dC5yZXBsYWNlKC9bLVxcL1xcXFxeJC4qKz8oKVtcXF17fXxdL2csICdcXFxcJCYnKTsgLy8gRXNjYXBlIHNwZWNpYWwgY2hhcmFjdGVyc1xyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IHsgc2VhcmNoQm9va3MgfTsgLy8gRXhwb3J0IHRoZSBzZWFyY2hCb29rcyBmdW5jdGlvbiB0byBiZSB1c2VkIGluIGluZGV4LmpzXHJcbiJdLCJtYXBwaW5ncyI6Im0wR0FlWTtBQUFBQSxjQUFBLFNBQUFBLENBQUEsU0FBQUMsY0FBQSxXQUFBQSxjQUFBLEVBQUFELGNBQUEsR0FmWjtBQUNBLEtBQU0sQ0FBQUUsSUFBSSxFQUFBRixjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLG1CQUFtQixDQUFDLEVBQ3pDLEtBQU0sQ0FBQUMsUUFBUSxFQUFBTCxjQUFBLEdBQUFHLENBQUEsTUFBR0MsT0FBTyxDQUFDLFVBQVUsQ0FBQyxFQUFFO0FBRXRDLGNBQWUsQ0FBQUUsV0FBV0EsQ0FBQ0MsR0FBRyxDQUFFQyxHQUFHLENBQUUsQ0FBQVIsY0FBQSxHQUFBUyxDQUFBLE1BQ2pDLEtBQU0sQ0FBQUMsS0FBSyxFQUFBVixjQUFBLEdBQUFHLENBQUEsTUFBR0ksR0FBRyxDQUFDRyxLQUFLLENBQUNBLEtBQUssRUFBRUMsV0FBVyxDQUFDLENBQUMsRUFBRTtBQUU5QztBQUFBWCxjQUFBLEdBQUFHLENBQUEsTUFDQSxHQUFJLENBQUFILGNBQUEsR0FBQVksQ0FBQSxVQUFDRixLQUFLLElBQUFWLGNBQUEsR0FBQVksQ0FBQSxTQUFJLE1BQU8sQ0FBQUYsS0FBSyxHQUFLLFFBQVEsSUFBQVYsY0FBQSxHQUFBWSxDQUFBLFNBQUlGLEtBQUssQ0FBQ0csSUFBSSxDQUFDLENBQUMsR0FBSyxFQUFFLEVBQUUsQ0FBQWIsY0FBQSxHQUFBWSxDQUFBLFNBQUFaLGNBQUEs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