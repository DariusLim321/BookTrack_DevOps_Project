function cov_2o5rgg2xk(){var path="C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\New folder\\BookTrack_DevOps_Project\\utils\\search-book-util.js";var hash="bc895884cb63c04056bb5bb0747bda0b12656cb2";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"C:\\Users\\linju\\Desktop\\TP Y2S2\\DVOPS\\Assignment\\New folder\\BookTrack_DevOps_Project\\utils\\search-book-util.js",statementMap:{"0":{start:{line:2,column:13},end:{line:2,column:41}},"1":{start:{line:3,column:17},end:{line:3,column:36}},"2":{start:{line:6,column:18},end:{line:6,column:48}},"3":{start:{line:9,column:4},end:{line:11,column:5}},"4":{start:{line:10,column:8},end:{line:10,column:121}},"5":{start:{line:14,column:4},end:{line:16,column:5}},"6":{start:{line:15,column:8},end:{line:15,column:99}},"7":{start:{line:19,column:34},end:{line:19,column:50}},"8":{start:{line:20,column:4},end:{line:22,column:5}},"9":{start:{line:21,column:8},end:{line:21,column:138}},"10":{start:{line:24,column:4},end:{line:46,column:5}},"11":{start:{line:26,column:30},end:{line:28,column:10}},"12":{start:{line:31,column:8},end:{line:33,column:9}},"13":{start:{line:32,column:12},end:{line:32,column:93}},"14":{start:{line:36,column:8},end:{line:36,column:44}},"15":{start:{line:39,column:8},end:{line:39,column:91}},"16":{start:{line:42,column:8},end:{line:45,column:11}},"17":{start:{line:52,column:4},end:{line:52,column:58}},"18":{start:{line:55,column:0},end:{line:55,column:33}}},fnMap:{"0":{name:"searchBooks",decl:{start:{line:5,column:15},end:{line:5,column:26}},loc:{start:{line:5,column:37},end:{line:48,column:1}},line:5},"1":{name:"escapeRegex",decl:{start:{line:51,column:9},end:{line:51,column:20}},loc:{start:{line:51,column:27},end:{line:53,column:1}},line:51}},branchMap:{"0":{loc:{start:{line:9,column:4},end:{line:11,column:5}},type:"if",locations:[{start:{line:9,column:4},end:{line:11,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:9},"1":{loc:{start:{line:9,column:8},end:{line:9,column:66}},type:"binary-expr",locations:[{start:{line:9,column:8},end:{line:9,column:14}},{start:{line:9,column:18},end:{line:9,column:43}},{start:{line:9,column:47},end:{line:9,column:66}}],line:9},"2":{loc:{start:{line:14,column:4},end:{line:16,column:5}},type:"if",locations:[{start:{line:14,column:4},end:{line:16,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:14},"3":{loc:{start:{line:20,column:4},end:{line:22,column:5}},type:"if",locations:[{start:{line:20,column:4},end:{line:22,column:5}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:20},"4":{loc:{start:{line:31,column:8},end:{line:33,column:9}},type:"if",locations:[{start:{line:31,column:8},end:{line:33,column:9}},{start:{line:undefined,column:undefined},end:{line:undefined,column:undefined}}],line:31}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0,"18":0},f:{"0":0,"1":0},b:{"0":[0,0],"1":[0,0,0],"2":[0,0],"3":[0,0],"4":[0,0]},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"bc895884cb63c04056bb5bb0747bda0b12656cb2"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_2o5rgg2xk=function(){return actualCoverage;};}return actualCoverage;}cov_2o5rgg2xk();// Import the Book model to interact with the database
const Book=(cov_2o5rgg2xk().s[0]++,require('../models/book.js'));const mongoose=(cov_2o5rgg2xk().s[1]++,require('mongoose'));// Import mongoose to validate object IDs
async function searchBooks(req,res){cov_2o5rgg2xk().f[0]++;const query=(cov_2o5rgg2xk().s[2]++,req.query.query?.toLowerCase());// Use optional chaining to safely access query
// Check if the query is provided and valid
cov_2o5rgg2xk().s[3]++;if((cov_2o5rgg2xk().b[1][0]++,!query)||(cov_2o5rgg2xk().b[1][1]++,typeof query!=='string')||(cov_2o5rgg2xk().b[1][2]++,query.trim()==='')){cov_2o5rgg2xk().b[0][0]++;cov_2o5rgg2xk().s[4]++;return res.status(400).json({error:'Invalid parameter: "query" is required and must be a non-empty string.'});}else{cov_2o5rgg2xk().b[0][1]++;}// Limit query length to 100 characters
cov_2o5rgg2xk().s[5]++;if(query.length>100){cov_2o5rgg2xk().b[2][0]++;cov_2o5rgg2xk().s[6]++;return res.status(400).json({error:'Query is too long. Max length is 100 characters.'});}else{cov_2o5rgg2xk().b[2][1]++;}// Check for special characters in the query (only allow alphanumeric and space)
const specialCharacterRegex=(cov_2o5rgg2xk().s[7]++,/[^a-zA-Z0-9\s]/);// Regular expression to check for non-alphanumeric characters
cov_2o5rgg2xk().s[8]++;if(specialCharacterRegex.test(query)){cov_2o5rgg2xk().b[3][0]++;cov_2o5rgg2xk().s[9]++;return res.status(400).json({error:'Query contains special characters. Only alphanumeric characters and spaces are allowed.'});}else{cov_2o5rgg2xk().b[3][1]++;}cov_2o5rgg2xk().s[10]++;try{// Search for books that match the title
const filteredBooks=(cov_2o5rgg2xk().s[11]++,await Book.find({title:{$regex:escapeRegex(query),$options:'i'}// Case-insensitive search with escaped query
}));// Check if any books are found
cov_2o5rgg2xk().s[12]++;if(filteredBooks.length===0){cov_2o5rgg2xk().b[4][0]++;cov_2o5rgg2xk().s[13]++;return res.status(404).json({message:'No books found matching your search.'});}else{cov_2o5rgg2xk().b[4][1]++;}// Return the filtered results
cov_2o5rgg2xk().s[14]++;res.status(200).json(filteredBooks);// Send 200 OK status with the results
}catch(error){cov_2o5rgg2xk().s[15]++;// Log the error for internal debugging
console.error('Error fetching books for query:',query,'\nError details:',error);// Send the correct error message to match the test case expectation
cov_2o5rgg2xk().s[16]++;res.status(500).json({message:'Internal Server Error',// Change this to match the test expectation
error:error.message// Optionally include the error message in logs or internal response
});}}// Function to escape regex special characters
function escapeRegex(text){cov_2o5rgg2xk().f[1]++;cov_2o5rgg2xk().s[17]++;return text.replace(/[-\/\\^$.*+?()[\]{}|]/g,'\\$&');// Escape special characters
}cov_2o5rgg2xk().s[18]++;module.exports={searchBooks};// Export the searchBooks function to be used in index.js
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJjb3ZfMm81cmdnMnhrIiwiYWN0dWFsQ292ZXJhZ2UiLCJCb29rIiwicyIsInJlcXVpcmUiLCJtb25nb29zZSIsInNlYXJjaEJvb2tzIiwicmVxIiwicmVzIiwiZiIsInF1ZXJ5IiwidG9Mb3dlckNhc2UiLCJiIiwidHJpbSIsInN0YXR1cyIsImpzb24iLCJlcnJvciIsImxlbmd0aCIsInNwZWNpYWxDaGFyYWN0ZXJSZWdleCIsInRlc3QiLCJmaWx0ZXJlZEJvb2tzIiwiZmluZCIsInRpdGxlIiwiJHJlZ2V4IiwiZXNjYXBlUmVnZXgiLCIkb3B0aW9ucyIsIm1lc3NhZ2UiLCJjb25zb2xlIiwidGV4dCIsInJlcGxhY2UiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZXMiOlsic2VhcmNoLWJvb2stdXRpbC5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBJbXBvcnQgdGhlIEJvb2sgbW9kZWwgdG8gaW50ZXJhY3Qgd2l0aCB0aGUgZGF0YWJhc2VcclxuY29uc3QgQm9vayA9IHJlcXVpcmUoJy4uL21vZGVscy9ib29rLmpzJyk7XHJcbmNvbnN0IG1vbmdvb3NlID0gcmVxdWlyZSgnbW9uZ29vc2UnKTsgLy8gSW1wb3J0IG1vbmdvb3NlIHRvIHZhbGlkYXRlIG9iamVjdCBJRHNcclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHNlYXJjaEJvb2tzKHJlcSwgcmVzKSB7XHJcbiAgICBjb25zdCBxdWVyeSA9IHJlcS5xdWVyeS5xdWVyeT8udG9Mb3dlckNhc2UoKTsgLy8gVXNlIG9wdGlvbmFsIGNoYWluaW5nIHRvIHNhZmVseSBhY2Nlc3MgcXVlcnlcclxuXHJcbiAgICAvLyBDaGVjayBpZiB0aGUgcXVlcnkgaXMgcHJvdmlkZWQgYW5kIHZhbGlkXHJcbiAgICBpZiAoIXF1ZXJ5IHx8IHR5cGVvZiBxdWVyeSAhPT0gJ3N0cmluZycgfHwgcXVlcnkudHJpbSgpID09PSAnJykge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnSW52YWxpZCBwYXJhbWV0ZXI6IFwicXVlcnlcIiBpcyByZXF1aXJlZCBhbmQgbXVzdCBiZSBhIG5vbi1lbXB0eSBzdHJpbmcuJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBMaW1pdCBxdWVyeSBsZW5ndGggdG8gMTAwIGNoYXJhY3RlcnNcclxuICAgIGlmIChxdWVyeS5sZW5ndGggPiAxMDApIHtcclxuICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDApLmpzb24oeyBlcnJvcjogJ1F1ZXJ5IGlzIHRvbyBsb25nLiBNYXggbGVuZ3RoIGlzIDEwMCBjaGFyYWN0ZXJzLicgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLy8gQ2hlY2sgZm9yIHNwZWNpYWwgY2hhcmFjdGVycyBpbiB0aGUgcXVlcnkgKG9ubHkgYWxsb3cgYWxwaGFudW1lcmljIGFuZCBzcGFjZSlcclxuICAgIGNvbnN0IHNwZWNpYWxDaGFyYWN0ZXJSZWdleCA9IC9bXmEtekEtWjAtOVxcc10vOyAvLyBSZWd1bGFyIGV4cHJlc3Npb24gdG8gY2hlY2sgZm9yIG5vbi1hbHBoYW51bWVyaWMgY2hhcmFjdGVyc1xyXG4gICAgaWYgKHNwZWNpYWxDaGFyYWN0ZXJSZWdleC50ZXN0KHF1ZXJ5KSkge1xyXG4gICAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMCkuanNvbih7IGVycm9yOiAnUXVlcnkgY29udGFpbnMgc3BlY2lhbCBjaGFyYWN0ZXJzLiBPbmx5IGFscGhhbnVtZXJpYyBjaGFyYWN0ZXJzIGFuZCBzcGFjZXMgYXJlIGFsbG93ZWQuJyB9KTtcclxuICAgIH1cclxuXHJcbiAgICB0cnkge1xyXG4gICAgICAgIC8vIFNlYXJjaCBmb3IgYm9va3MgdGhhdCBtYXRjaCB0aGUgdGl0bGVcclxuICAgICAgICBjb25zdCBmaWx0ZXJlZEJvb2tzID0gYXdhaXQgQm9vay5maW5kKHtcclxuICAgICAgICAgICAgdGl0bGU6IHsgJHJlZ2V4OiBlc2NhcGVSZWdleChxdWVyeSksICRvcHRpb25zOiAnaScgfSAvLyBDYXNlLWluc2Vuc2l0aXZlIHNlYXJjaCB3aXRoIGVzY2FwZWQgcXVlcnlcclxuICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgLy8gQ2hlY2sgaWYgYW55IGJvb2tzIGFyZSBmb3VuZFxyXG4gICAgICAgIGlmIChmaWx0ZXJlZEJvb2tzLmxlbmd0aCA9PT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oeyBtZXNzYWdlOiAnTm8gYm9va3MgZm91bmQgbWF0Y2hpbmcgeW91ciBzZWFyY2guJyB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIC8vIFJldHVybiB0aGUgZmlsdGVyZWQgcmVzdWx0c1xyXG4gICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKGZpbHRlcmVkQm9va3MpOyAvLyBTZW5kIDIwMCBPSyBzdGF0dXMgd2l0aCB0aGUgcmVzdWx0c1xyXG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcclxuICAgICAgICAvLyBMb2cgdGhlIGVycm9yIGZvciBpbnRlcm5hbCBkZWJ1Z2dpbmdcclxuICAgICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBmZXRjaGluZyBib29rcyBmb3IgcXVlcnk6JywgcXVlcnksICdcXG5FcnJvciBkZXRhaWxzOicsIGVycm9yKTtcclxuICAgIFxyXG4gICAgICAgIC8vIFNlbmQgdGhlIGNvcnJlY3QgZXJyb3IgbWVzc2FnZSB0byBtYXRjaCB0aGUgdGVzdCBjYXNlIGV4cGVjdGF0aW9uXHJcbiAgICAgICAgcmVzLnN0YXR1cyg1MDApLmpzb24oe1xyXG4gICAgICAgICAgICBtZXNzYWdlOiAnSW50ZXJuYWwgU2VydmVyIEVycm9yJywgLy8gQ2hhbmdlIHRoaXMgdG8gbWF0Y2ggdGhlIHRlc3QgZXhwZWN0YXRpb25cclxuICAgICAgICAgICAgZXJyb3I6IGVycm9yLm1lc3NhZ2UgLy8gT3B0aW9uYWxseSBpbmNsdWRlIHRoZSBlcnJvciBtZXNzYWdlIGluIGxvZ3Mgb3IgaW50ZXJuYWwgcmVzcG9uc2VcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIFxyXG59XHJcblxyXG4vLyBGdW5jdGlvbiB0byBlc2NhcGUgcmVnZXggc3BlY2lhbCBjaGFyYWN0ZXJzXHJcbmZ1bmN0aW9uIGVzY2FwZVJlZ2V4KHRleHQpIHtcclxuICAgIHJldHVybiB0ZXh0LnJlcGxhY2UoL1stXFwvXFxcXF4kLiorPygpW1xcXXt9fF0vZywgJ1xcXFwkJicpOyAvLyBFc2NhcGUgc3BlY2lhbCBjaGFyYWN0ZXJzXHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0geyBzZWFyY2hCb29rcyB9OyAvLyBFeHBvcnQgdGhlIHNlYXJjaEJvb2tzIGZ1bmN0aW9uIHRvIGJlIHVzZWQgaW4gaW5kZXguanNcclxuIl0sIm1hcHBpbmdzIjoiNHlHQWVZO0FBQUFBLGFBQUEsU0FBQUEsQ0FBQSxTQUFBQyxjQUFBLFdBQUFBLGNBQUEsRUFBQUQsYUFBQSxHQWZaO0FBQ0EsS0FBTSxDQUFBRSxJQUFJLEVBQUFGLGFBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsbUJBQW1CLENBQUMsRUFDekMsS0FBTSxDQUFBQyxRQUFRLEVBQUFMLGFBQUEsR0FBQUcsQ0FBQSxNQUFHQyxPQUFPLENBQUMsVUFBVSxDQUFDLEVBQUU7QUFFdEMsY0FBZSxDQUFBRSxXQUFXQSxDQUFDQyxHQUFHLENBQUVDLEdBQUcsQ0FBRSxDQUFBUixhQUFBLEdBQUFTLENBQUEsTUFDakMsS0FBTSxDQUFBQyxLQUFLLEVBQUFWLGFBQUEsR0FBQUcsQ0FBQSxNQUFHSSxHQUFHLENBQUNHLEtBQUssQ0FBQ0EsS0FBSyxFQUFFQyxXQUFXLENBQUMsQ0FBQyxFQUFFO0FBRTlDO0FBQUFYLGFBQUEsR0FBQUcsQ0FBQSxNQUNBLEdBQUksQ0FBQUgsYUFBQSxHQUFBWSxDQUFBLFVBQUNGLEtBQUssSUFBQVYsYUFBQSxHQUFBWSxDQUFBLFNBQUksTUFBTyxDQUFBRixLQUFLLEdBQUssUUFBUSxJQUFBVixhQUFBLEdBQUFZLENBQUEsU0FBSUYsS0FBSyxDQUFDRyxJQUFJLENBQUMsQ0FBQyxHQUFLLEVBQUUsRUFBRSxDQUFBYixhQUFB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